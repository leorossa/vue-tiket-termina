# Ticket Terminal - Административная панель

Административная панель для системы продажи билетов, разработанная с использованием Vue.js 3, Pinia и интеграцией с Spring Boot бэкендом.

## Содержание

- [Установка и запуск](#установка-и-запуск)
- [Авторизация](#авторизация)
- [Структура проекта](#структура-проекта)
- [Основные функции](#основные-функции)
- [API интеграция](#api-интеграция)
- [Управление состоянием](#управление-состоянием)
- [Разработка и расширение](#разработка-и-расширение)
- [Решение проблем](#решение-проблем)

## Установка и запуск

### Требования

- Node.js (версия 16 или выше)
- npm или yarn
- Запущенный бэкенд TicketTerminal-API (Spring Boot)

### Шаги установки

1. Клонировать репозиторий:
   ```bash
   git clone https://github.com/leorossa/vue-tiket-termina.git
   cd vue-tiket-termina
   ```

2. Установить зависимости:
   ```bash
   npm install
   # или
   yarn install
   ```

3. Запустить приложение в режиме разработки:
   ```bash
   npm run dev
   # или
   npm start
   # или
   yarn dev
   ```

4. Для сборки проекта:
   ```bash
   npm run build
   # или
   yarn build
   ```

## Авторизация

### Учетные данные для входа

Для доступа к административной панели используйте следующие учетные данные:

- **Логин**: `Admin`
- **Пароль**: `Admin123`

Эти учетные данные указаны в файле конфигурации бэкенда `application.yml` в разделе:

```yaml
application:
  clients:
    tonline-gate:
      url: http://localhost:8181
      login: Admin
      password: Admin123
```

### Роли пользователей

В системе предусмотрены следующие роли:

- **Администратор (admin)**: Полный доступ ко всем функциям системы
- **Менеджер (manager)**: Доступ к управлению услугами и просмотру статистики
- **Кассир (cashier)**: Ограниченный доступ только к функциям продажи билетов

## Структура проекта

```
vue-tiket-termina/
├── public/               # Статические файлы
├── src/
│   ├── api/              # API сервисы для взаимодействия с бэкендом
│   ├── assets/           # Изображения, шрифты и другие ресурсы
│   ├── components/       # Переиспользуемые компоненты
│   ├── router/           # Настройки маршрутизации
│   ├── stores/           # Хранилища Pinia
│   ├── views/            # Компоненты представлений
│   │   ├── admin/        # Компоненты административной панели
│   │   └── Login.vue     # Компонент авторизации
│   ├── App.vue           # Корневой компонент
│   └── main.js           # Точка входа
├── .gitignore            # Исключения Git
├── package.json          # Зависимости и скрипты
├── vite.config.js        # Конфигурация Vite
└── README.md             # Документация проекта
```

## Основные функции

### Панель управления (Dashboard)

- Отображение общей статистики системы
- Графики продаж по периодам
- Список последних продаж
- Популярные услуги

### Управление услугами

- Просмотр списка услуг
- Создание новых услуг
- Редактирование существующих услуг
- Настройка цен и параметров услуг

### Управление пользователями

- Просмотр списка пользователей
- Создание новых пользователей
- Редактирование профилей пользователей
- Блокировка/разблокировка пользователей
- Управление ролями и правами доступа

### Настройки системы

- Общие настройки
- Настройки API
- Настройки видеозаставок
- Настройки печати билетов
- Управление сменами

## API интеграция

Приложение интегрируется с бэкендом через REST API. Основные эндпоинты:

- `/api/Service/*` - управление услугами
- `/api/User/*` - управление пользователями
- `/api/Settings/*` - управление настройками
- `/api/Shift/*` - управление сменами
- `/api/Sale/*` - управление продажами

Все запросы к API требуют базовой HTTP-авторизации (Basic Auth).

### Важно: Контекстный путь API

Бэкенд настроен на работу с контекстным путем `/TLMuseumGate/REST`. В файле `vite.config.js` настроено проксирование запросов с `/api` на этот контекстный путь:

```javascript
server: {
  proxy: {
    '/api': {
      target: 'http://localhost:8181',
      changeOrigin: true,
      rewrite: (path) => path.replace(/^\/api/, '/TLMuseumGate/REST')
    }
  }
}
```

## Управление состоянием

Для управления состоянием приложения используется Pinia. Основные хранилища:

- `authStore.js` - управление аутентификацией
- `serviceStore.js` - управление услугами
- `userStore.js` - управление пользователями
- `settingsStore.js` - управление настройками системы

## Разработка и расширение

### Добавление новых компонентов

1. Создайте новый компонент в соответствующей директории
2. Добавьте маршрут в `router.js`
3. При необходимости создайте новое хранилище Pinia

### Интеграция с новыми API

1. Добавьте новые методы в соответствующий API-сервис в директории `api/`
2. Интегрируйте API с хранилищем Pinia
3. Используйте данные в компонентах через хранилище

## Решение проблем

### Ошибка 404 при авторизации

Если вы получаете ошибку 404 при попытке авторизации, проверьте следующее:

1. **Запущен ли бэкенд**
   - Убедитесь, что бэкенд запущен и доступен по адресу, указанному в `vite.config.js`
   - По умолчанию бэкенд должен быть доступен по адресу `http://localhost:8181`

2. **Правильность контекстного пути**
   - Проверьте, что в файле `vite.config.js` правильно настроено проксирование запросов с `/api` на `/TLMuseumGate/REST`

3. **Правильность учетных данных**
   - Используйте учетные данные `Admin` / `Admin123`, указанные в `application.yml`

4. **Порт бэкенда**
   - Убедитесь, что бэкенд запущен на порту 8181, как указано в `application.yml`

### Проблемы с CORS

Если вы получаете ошибки CORS, проверьте настройки `allowed-origins` в файле `application.yml`. По умолчанию разрешены следующие источники:

```yaml
application:
  allowed-origins:
    - "http://localhost:*"
    - "http://localhost:1420"
    - "https://tauri.localhost"
    - "tauri://localhost"
```

Убедитесь, что ваш фронтенд запущен на одном из этих адресов, или добавьте свой адрес в список разрешенных.

### Логирование

Для отладки проблем с авторизацией и API-запросами используйте консоль браузера. В хранилище `authStore.js` добавлено подробное логирование ошибок авторизации, которое поможет выявить причину проблемы.
